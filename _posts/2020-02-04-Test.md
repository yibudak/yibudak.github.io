---
title: PriviaHub CTF Sombrero Write-Up
published: true
---

bu yazımda PriviaHub içerisinde bulunan “Sombrero” adlı meydan okumanın çözümünü anlatacağım, dilerseniz hemen başlayalım!

sorumuz şu şekilde:

![image](post_resources/sombrero/description.png)

# [](#header-3)ön çalışma

Sombrero adlı bu zararlı yazılım 16 KB boyutunda ve hashlenmiş bir isme sahip. Çalışmamızı kolaylaştırmak için dosyanın ismini sombrero olarak değiştireceğim.

![image](post_resources/sombrero/changename.png)

Ardından ise dosyayı ilk ve en basit analizden geçirmek için VirusTotal sitesine yüklüyorum…

![image](post_resources/sombrero/virustotal.png)

Virustotal’in bize dediğine göre bu dosya OSX’de ARM mimarisi üstünde çalışan ve Mach-O dosya biçimine sahip. Her ne kadar basit bir tarama yöntemi demiş olsam da sanırım bizim işimize yarayacak bilgilerin çoğunu buradan elde ettik. Yukarıdaki bilgilere göre yüksek ihtimalle bizim elimizde, iOS platformunda çalışan bir zararlı yazılım var. Bundan sonra yapacaklarım ise şu şekilde;

1. Elimizdeki zararlıyı uygun bir disassembler kullanarak makine kodlarına dönüştürmek.
1. Komuta kontrol sunucusunun IP adresini bildiğim bir iOS zararlısı oluşturmak ve oluşturduğum zararlıyı aynı şekilde dissasembler kullanarak makine kodlarına çevirmek.
1. En sonunda ise elimdeki iki farklı zararlının makine kodlarını karşılaştırmak.

# [](#header-3)zararlı analizi

Yol haritamı belirledikten sonra çalışmalara başlıyorum. Öncelikle disassembler olarak işin kolayına kaçarak IDA’yı kullanmaya karar veriyorum.

![image](post_resources/sombrero/ida.png)

Fakat yukarıda görüleceği gibi IDA bu dosyayı disassemble etmekte pek başarılı olamıyor. Durum böyle olunca ben de başka bir yazılım kullanarak analiz etmeyi planlıyorum ve karşıma objdump çıkıyor. Basit ve işlevsel olan bu yazılımı ARM mimarisi için kullanmak istiyorsak bilgisayarımızda GNU ToolChain for ARM paketine ihtiyacımız var. Bunun için aşağıdaki komutu kullanabiliriz.

![image](post_resources/sombrero/installpackages.png)

Gerekli paketleri sağladıktan sonra disassemble işlemimize geçelim. “objdump” yazılımına doğru parametreleri vererek zararlımızı makine kodlarına çeviriyoruz. Bu işlemi aşağıdaki görselden görebilirsiniz.

![image](post_resources/sombrero/objdump.png)

Buraya kadar çok güzel… Şimdi bu CTF’in biraz uğraştırıcı kısmına geçelim isterseniz. Elimizde zararlımızın makine kodları olmasına rağmen onunla karşılaştıracak bir başka zararlımız yok. Bunun için deneme yanılma yapmamız veya tahmin etmemiz gerekecek.

Sombrero’nun karşısına koyacak bir zararlı istiyorsak bunun için bakmamız gereken yer metasploit’in içerisindeki payload listesi olacaktır. “show payloads” komutunu kullanarak msfconsole’un içerisindeki payload’ları görebiliriz.

Sombrero’nun spesifik özelliklerinden yola çıkarak aşağıdaki payload’u seçiyorum. Eğer benzerlik sağlayamazsam diğerlerini de deneyebilirim.

![image](post_resources/sombrero/payload.png)

Kendi zararlımı oluşturuyorum…

![image](post_resources/sombrero/msfconsole.png)

Burada not edilmesi gereken bir şey var. Yazdığım IP adresinin HEX değerini bilmem gerekiyor ki sample’ımı disassemble ettiğimde elimdeki değeri aratabileyim ve nasıl bir instruction olduğunu bulabileyim.

192.168.55.55 > C0 A8 37 37 fakat bunlar bellekte ters tutulacağı için IP adresimiz şu şekilde olmalı: `3737a8c0`

Yukarıda yaptığım gibi sample adını verdiğim zararlımı da disassemble ediyorum ve elimde iki adet dosya oluyor.

![image](post_resources/sombrero/compare.png)

Boyutlarına dikkat edersek, ikisinin aynı payload türünden olma ihtimali çok yüksek. Şanslıyız! Şimdi tek yapmamız gereken bizim yazdığımız IP adresini makine kodları arasında aramak ve iki dosyayı karşılaştırmak.

sampleAssembly dosyasından:

![image](post_resources/sombrero/sampleassembly.png)

sombreroAssembly dosyasından:

![image](post_resources/sombrero/sombreroassembly.png)

Ta daa!!

IP adresimizi makine kodları arasında bulduk. Şimdi ise tek yapmamız gereken bu değeri IP adresine çevirmek.

`0d01a8c0 > 192.168.1.13`

Flag’ımızı elde ettik:

`PRIVIAHUB{192.168.1.13}`

Görünen o ki hiç kendi sample’ımızı oluşturmadan direkt olarak “192.168” değerine denk olan “a8c0” değerini de aratabilirdik fakat her zaman emin olmak iyidir.

Başka bir Write-up’da görüşmek üzere, sevgilerle!!

yibudak